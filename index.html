<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Para Ti, Sof√≠a üíõ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600&family=Dancing+Script:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --warm: #FFF8F0;
            --soft-pink: #FFE4E6;
            --rose: #FB7185;
            --deep-rose: #E11D48;
            --gold: #F59E0B;
            --dark: #1E1B2E;
            --storm: #0F0E17;
            --text-light: #FFFFFE;
            --text-dark: #2B2D42;
            --lavender: #C4B5FD;
            --sky: #7DD3FC;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        body {
            background: var(--storm);
            color: var(--text-light);
        }

        /* ============ SCENE SYSTEM ============ */
        .scene {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 1.5rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
            overflow-y: auto;
            
        }

        .scene.active {
            opacity: 1;
            pointer-events: all;
            z-index: 10;
        }

        /* ============ PARTICLES CANVAS ============ */
        #particles {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* ============ SCENE 0: INTRO ============ */
        .scene-intro {
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0a0a12 100%);
        }

        .intro-envelope {
            width: 120px;
            height: 90px;
            position: relative;
            cursor: pointer;
            animation: floatEnvelope 3s ease-in-out infinite;
            margin-bottom: 2rem;
        }

        .envelope-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #FFE4E6, #FFC1CC);
            border-radius: 4px 4px 12px 12px;
            position: relative;
            box-shadow: 0 10px 40px rgba(251, 113, 133, 0.3);
        }

        .envelope-flap {
            position: absolute;
            top: 0; left: 0;
            width: 0; height: 0;
            border-left: 60px solid transparent;
            border-right: 60px solid transparent;
            border-top: 55px solid #FFB3C1;
            transform-origin: top center;
            transition: transform 0.6s ease;
        }

        .intro-envelope:hover .envelope-flap,
        .intro-envelope.opened .envelope-flap {
            transform: rotateX(180deg);
        }

        .envelope-heart {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes floatEnvelope {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        .intro-text {
            font-family: 'Dancing Script', cursive;
            font-size: 1.4rem;
            color: var(--soft-pink);
            opacity: 0;
            transition: opacity 0.8s ease 0.3s;
            text-align: center;
        }

        .intro-text.visible {
            opacity: 1;
        }

        .intro-name {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--rose), var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0.5rem 0 1.5rem;
            opacity: 0;
            transition: opacity 0.8s ease 0.6s;
        }

        .intro-name.visible {
            opacity: 1;
        }

        .btn-start {
            background: linear-gradient(135deg, var(--rose), var(--deep-rose));
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            opacity: 0;
            transition: all 0.4s ease;
            box-shadow: 0 8px 30px rgba(225, 29, 72, 0.4);
            letter-spacing: 0.5px;
        }

        .btn-start.visible {
            opacity: 1;
            animation: softPulse 2.5s ease-in-out infinite;
        }

        .btn-start:active {
            transform: scale(0.95);
        }

        @keyframes softPulse {
            0%, 100% { box-shadow: 0 8px 30px rgba(225, 29, 72, 0.4); }
            50% { box-shadow: 0 8px 50px rgba(225, 29, 72, 0.7); }
        }

        /* ============ SCENE 1: LA TORMENTA ============ */
        .scene-storm {
            background: linear-gradient(180deg, #0a0a12 0%, #1a1a2e 50%, #2d1f3d 100%);
        }

        .rain-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .raindrop {
            position: absolute;
            top: -20px;
            width: 2px;
            background: linear-gradient(to bottom, transparent, rgba(196, 181, 253, 0.5));
            border-radius: 0 0 2px 2px;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to { transform: translateY(110vh); }
        }

        .storm-emoji {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            animation: floatEnvelope 3s ease-in-out infinite;
        }

        .storm-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--lavender);
            line-height: 1.3;
        }

        .typewriter {
            font-family: 'Inter', sans-serif;
            font-size: 1.05rem;
            font-weight: 300;
            line-height: 1.8;
            text-align: center;
            color: rgba(255, 255, 255, 0.85);
            max-width: 600px;
            min-height: 120px;
        }

        .typewriter .cursor {
            display: inline-block;
            width: 2px;
            height: 1.1em;
            background: var(--lavender);
            margin-left: 2px;
            vertical-align: text-bottom;
            animation: blink 0.8s step-end infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        .scene-btn {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 0.9rem 2rem;
            border-radius: 50px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 400;
            cursor: pointer;
            margin-top: 2rem;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .scene-btn.visible {
            opacity: 1;
        }

        .scene-btn:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.15);
        }

        /* ============ SCENE 2: LO QUE NO DIJE ============ */
        .scene-truth {
            background: linear-gradient(180deg, #1a1a2e 0%, #1e293b 50%, #1e1b2e 100%);
        }

        .truth-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
            color: var(--sky);
        }

        .truth-subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 2rem;
            text-align: center;
        }

        .clouds-area {
            position: relative;
            width: 100%;
            max-width: 500px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
        }

        .cloud-card {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 1.2rem 1.5rem;
            width: 90%;
            cursor: pointer;
            transition: all 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .cloud-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(125, 211, 252, 0.1), rgba(196, 181, 253, 0.1));
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .cloud-card.revealed::before {
            opacity: 1;
        }

        .cloud-label {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--sky);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cloud-text {
            font-size: 0.95rem;
            font-weight: 300;
            line-height: 1.7;
            color: rgba(255, 255, 255, 0.85);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.6s ease, opacity 0.5s ease;
            opacity: 0;
        }

        .cloud-card.revealed .cloud-text {
            max-height: 300px;
            opacity: 1;
        }

        .cloud-tap {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.35);
            text-align: center;
            margin-top: 0.3rem;
            transition: opacity 0.3s ease;
        }

        .cloud-card.revealed .cloud-tap {
            opacity: 0;
        }

        .clouds-counter {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 1rem;
        }

        /* ============ SCENE 3: LO QUE SIENTO ============ */
        .scene-love {
            background: linear-gradient(180deg, #1e1b2e 0%, #2d1532 50%, #3d1230 100%);
        }

        .love-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            color: var(--rose);
            margin-bottom: 0.3rem;
        }

        .love-subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 1.5rem;
        }

        .love-carousel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 500px;
            max-height: 55vh;
            overflow-y: auto;
            padding: 0.5rem;
            scrollbar-width: none;
        }

        .love-carousel::-webkit-scrollbar { display: none; }

        .love-card {
            background: linear-gradient(135deg, rgba(251, 113, 133, 0.12), rgba(245, 158, 11, 0.08));
            border: 1px solid rgba(251, 113, 133, 0.2);
            border-radius: 20px;
            padding: 1.3rem 1.5rem;
            cursor: pointer;
            transition: all 0.5s ease;
            transform: translateY(20px);
            opacity: 0;
        }

        .love-card.show {
            transform: translateY(0);
            opacity: 1;
        }

        .love-card-emoji {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .love-card-text {
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            font-weight: 400;
            font-style: italic;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }

        /* ============ SCENE 4: PUZZLE ============ */
        .scene-puzzle {
            background: linear-gradient(180deg, #1e1b2e 0%, #1a1a2e 100%);
        }

        .puzzle-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            font-weight: 700;
            text-align: center;
            color: var(--gold);
            margin-bottom: 0.3rem;
        }

        .puzzle-subtitle {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.45);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 280px;
            height: 280px;
            margin-bottom: 1.5rem;
        }

        .puzzle-piece {
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.4s ease;
            user-select: none;
            -webkit-user-select: none;
        }

        .puzzle-piece.found {
            background: linear-gradient(135deg, rgba(251, 113, 133, 0.2), rgba(245, 158, 11, 0.15));
            border-color: rgba(251, 113, 133, 0.4);
            animation: pieceReveal 0.5s ease;
        }

        @keyframes pieceReveal {
            0% { transform: scale(0.5) rotateY(180deg); }
            100% { transform: scale(1) rotateY(0deg); }
        }

        .puzzle-message {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            font-style: italic;
            text-align: center;
            color: var(--gold);
            opacity: 0;
            transition: opacity 0.8s ease;
            max-width: 400px;
            line-height: 1.6;
        }

        .puzzle-message.visible {
            opacity: 1;
        }

        /* ============ SCENE 5: COMPROMISOS ============ */
        .scene-promises {
            background: linear-gradient(180deg, #1a1a2e 0%, #1e2a1e 50%, #1a2a1a 100%);
        }

        .promises-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            color: #86EFAC;
            margin-bottom: 0.3rem;
        }

        .promises-subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 1.05rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 2rem;
            text-align: center;
        }

        .promises-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 500px;
        }

        .promise-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            background: rgba(134, 239, 172, 0.05);
            border: 1px solid rgba(134, 239, 172, 0.12);
            border-radius: 16px;
            padding: 1.1rem 1.3rem;
            opacity: 0;
            transform: translateX(-30px);
            transition: all 0.6s ease;
        }

        .promise-item.show {
            opacity: 1;
            transform: translateX(0);
        }

        .promise-icon {
            font-size: 1.4rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .promise-text {
            font-size: 0.95rem;
            font-weight: 300;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.85);
        }

        .promise-note {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.4);
            font-style: italic;
            text-align: center;
            margin-top: 1.5rem;
            max-width: 400px;
            line-height: 1.5;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .promise-note.visible {
            opacity: 1;
        }

        /* ============ SCENE 6: FINAL ============ */
        .scene-final {
            background: radial-gradient(ellipse at center, #2d1532 0%, #1e1b2e 50%, #0a0a12 100%);
        }

        .final-heart {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.1); }
        }

        .final-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            background: linear-gradient(135deg, var(--rose), var(--gold), var(--lavender));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1.5rem;
            line-height: 1.3;
        }

        .final-message {
            font-size: 1rem;
            font-weight: 300;
            line-height: 1.8;
            text-align: center;
            color: rgba(255, 255, 255, 0.85);
            max-width: 500px;
            margin-bottom: 2rem;
        }

        .btn-song {
            background: linear-gradient(135deg, #1DB954, #1AA34A);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 30px rgba(29, 185, 84, 0.4);
            display: flex;
            align-items: center;
            gap: 0.6rem;
            text-decoration: none;
        }

        .btn-song:active {
            transform: scale(0.95);
        }

        .btn-song svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .final-footer {
            position: absolute;
            bottom: 2rem;
            font-family: 'Dancing Script', cursive;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.3);
        }

        /* ============ CONFETTI ============ */
        .confetti-piece {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -20px;
            z-index: 100;
            animation: confettiFall linear forwards;
            pointer-events: none;
        }

        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }

        /* ============ FLOATING HEARTS ============ */
        .floating-heart {
            position: fixed;
            pointer-events: none;
            z-index: 50;
            animation: floatUp 3s ease-out forwards;
            font-size: 1.5rem;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-200px) scale(0.3); }
        }

        /* ============ PROGRESS BAR ============ */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--rose), var(--gold), var(--lavender));
            z-index: 999;
            transition: width 0.8s ease;
        }
    </style>
</head>
<body>

    <!-- Progress -->
    <div class="progress-bar" id="progressBar" style="width: 0%"></div>

    <!-- Particles -->
    <canvas id="particles"></canvas>

    <!-- ===== SCENE 0: INTRO ===== -->
    <div class="scene scene-intro active" id="scene0">
        <div class="intro-envelope" id="envelope">
            <div class="envelope-body">
                <div class="envelope-flap"></div>
                <div class="envelope-heart">üíå</div>
            </div>
        </div>
        <p class="intro-text" id="introText">Esto es para ti...</p>
        <h1 class="intro-name" id="introName">Sof√≠a</h1>
        <button class="btn-start" id="btnStart" onclick="goToScene(1)">Abrir mi coraz√≥n</button>
    </div>

    <!-- ===== SCENE 1: LA TORMENTA ===== -->
    <div class="scene scene-storm" id="scene1">
        <div class="rain-container" id="rainContainer"></div>
        <div class="storm-emoji">üåßÔ∏è</div>
        <h2 class="storm-title">La Tormenta</h2>
        <div class="typewriter" id="stormText"></div>
        <button class="scene-btn" id="btnScene1" onclick="goToScene(2)">¬øQu√© pas√≥ realmente? ‚Üí</button>
    </div>

    <!-- ===== SCENE 2: LO QUE NO DIJE ===== -->
    <div class="scene scene-truth" id="scene2">
        <h2 class="truth-title">Lo que no dije</h2>
        <p class="truth-subtitle">Toca cada nube para despejarla ‚òÅÔ∏è</p>
        <div class="clouds-area" id="cloudsArea">
            <div class="cloud-card" onclick="revealCloud(this, 0)">
                <div class="cloud-label">‚òÅÔ∏è La verdad es que...</div>
                <div class="cloud-text">No fue que no me importara. Me puse bravo. Y cuando me pongo as√≠, me cierro. No soy de buscar, Sofi. Nunca lo he sido. Pero eso no significa que no me doliera verte irte.</div>
                <div class="cloud-tap">toca para revelar</div>
            </div>
            <div class="cloud-card" onclick="revealCloud(this, 1)">
                <div class="cloud-label">üå´Ô∏è Lo que sent√≠...</div>
                <div class="cloud-text">Sent√≠ rabia, pero no contigo... con la situaci√≥n. √öltimamente traigo mucha ansiedad encima por cosas que quiero lograr, y cuando se sum√≥ el problema, no supe manejarlo. Me qued√© quieto cuando deb√≠ ir por ti.</div>
                <div class="cloud-tap">toca para revelar</div>
            </div>
            <div class="cloud-card" onclick="revealCloud(this, 2)">
                <div class="cloud-label">üí≠ Lo que quiero que sepas...</div>
                <div class="cloud-text">Que me cuesta. Me cuesta mucho hablar de estas cosas, abrirme cuando hay conflicto. Tu forma de resolver es diferente a la m√≠a, y a veces no s√© c√≥mo llegar a ti sin que se sienta como una promesa que despu√©s me cobres. Pero estoy aqu√≠, intent√°ndolo... a mi manera.</div>
                <div class="cloud-tap">toca para revelar</div>
            </div>
        </div>
        <p class="clouds-counter" id="cloudsCounter">0 de 3 nubes despejadas</p>
        <button class="scene-btn" id="btnScene2" onclick="goToScene(3)" style="display:none">Hay m√°s que quiero decirte ‚Üí</button>
    </div>

    <!-- ===== SCENE 3: LO QUE SIENTO ===== -->
    <div class="scene scene-love" id="scene3">
        <h2 class="love-title">Lo que siento por ti</h2>
        <p class="love-subtitle">Cada una es real, Sofi</p>
        <div class="love-carousel" id="loveCarousel">
            <div class="love-card">
                <div class="love-card-emoji">üåô</div>
                <div class="love-card-text">"Me encanta que te quedas. Que a pesar de todo, sigues aqu√≠. Yo s√© que es porque me amas much√≠simo... y quiero que sepas que yo tambi√©n."</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">üî•</div>
                <div class="love-card-text">"Me haces querer ser mejor. No perfecto, mejor. Y eso es algo que nadie m√°s me ha hecho sentir."</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">üè†</div>
                <div class="love-card-text">"Me proyecto contigo. No lo digo por decir. Lo siento cada vez que pienso en el futuro y t√∫ est√°s en todos los escenarios."</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">üíõ</div>
                <div class="love-card-text">"Tu sensibilidad no es un defecto, Sofi. Es lo que te hace especial. A veces no s√© c√≥mo cuidarla, pero no quiero que la pierdas."</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">üåª</div>
                <div class="love-card-text">"Quiero cambiar ciertas cosas, no porque me lo pidas sino porque te amo. Pero necesito que sea a mi ritmo, juntos, sin que pese despu√©s."</div>
            </div>
        </div>
        <button class="scene-btn visible" onclick="goToScene(4)" style="margin-top:1rem">A√∫n hay algo m√°s ‚Üí</button>
    </div>

    <!-- ===== SCENE 4: PUZZLE ===== -->
    <div class="scene scene-puzzle" id="scene4">
        <h2 class="puzzle-title">üß© Juntando las piezas</h2>
        <p class="puzzle-subtitle">Toca las piezas en orden para armar nuestro mensaje</p>
        <div class="puzzle-grid" id="puzzleGrid"></div>
        <p class="puzzle-message" id="puzzleMessage">"A veces las piezas se desordenan, pero siempre encajan cuando estamos juntos... porque as√≠ somos t√∫ y yo."</p>
        <button class="scene-btn" id="btnScene4" onclick="goToScene(5)" style="display:none">Lo que voy a hacer ‚Üí</button>
    </div>

    <!-- ===== SCENE 5: COMPROMISOS ===== -->
    <div class="scene scene-promises" id="scene5">
        <h2 class="promises-title">No son promesas</h2>
        <p class="promises-subtitle">Son intenciones reales, con altibajos incluidos</p>
        <div class="promises-list" id="promisesList">
            <div class="promise-item">
                <div class="promise-icon">üö∂</div>
                <div class="promise-text">Voy a aprender a buscarte. Aunque me cueste, aunque est√© bravo. Porque irme no significa que no me importe.</div>
            </div>
            <div class="promise-item">
                <div class="promise-icon">üó£Ô∏è</div>
                <div class="promise-text">Voy a intentar hablar m√°s, aunque no me salga perfecto. Prefiero decirlo mal a no decirlo.</div>
            </div>
            <div class="promise-item">
                <div class="promise-icon">ü§ù</div>
                <div class="promise-text">Quiero que resolvamos juntos, no uno contra el otro. Tu forma de sentir importa, y la m√≠a tambi√©n.</div>
            </div>
            <div class="promise-item">
                <div class="promise-icon">üåä</div>
                <div class="promise-text">Habr√° d√≠as dif√≠ciles. No voy a ser perfecto, y probablemente la riegue otra vez. Pero voy a estar, Sofi. Siempre voy a estar.</div>
            </div>
            <div class="promise-item">
                <div class="promise-icon">üíõ</div>
                <div class="promise-text">Esto no es un contrato. No es algo para sacarnos en cara. Es mi forma de decirte que estoy trabajando en m√≠... por nosotros.</div>
            </div>
        </div>
        <p class="promise-note" id="promiseNote">No te pido que sea f√°cil. Solo que lo intentemos juntos.</p>
        <button class="scene-btn" id="btnScene5" onclick="goToScene(6)" style="display:none">Un √∫ltimo paso ‚Üí</button>
    </div>

    <!-- ===== SCENE 6: FINAL ===== -->
    <div class="scene scene-final" id="scene6">
        <div class="final-heart">‚ù§Ô∏è</div>
        <h2 class="final-title">Te elijo, Sof√≠a.<br>Hoy y siempre.</h2>
        <p class="final-message" id="finalMsg"></p>
        <a class="btn-song" href="https://open.spotify.com/intl-es/track/7GzRxRiDEBBa42S6Nx3IHJ?si=45b9fca28bb04bdf" target="_blank">
            <svg viewBox="0 0 24 24"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381C8.64 5.801 15.6 6.001 20.1 8.461c.54.3.72 1.02.42 1.56-.299.421-1.02.599-1.439.359z"/></svg>
            Escuchar nuestra canci√≥n üéµ
        </a>
        <p class="final-footer">hecho con el üíõ ‚Äî para mi Sofi</p>
    </div>

    <script>
        // ============ PARTICLES ============
        const canvas = document.getElementById('particles');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let particleColor = 'rgba(196, 181, 253, 0.3)';

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        class Particle {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2 + 0.5;
                this.speedY = -Math.random() * 0.3 - 0.1;
                this.speedX = (Math.random() - 0.5) * 0.3;
                this.opacity = Math.random() * 0.5 + 0.1;
            }
            update() {
                this.y += this.speedY;
                this.x += this.speedX;
                if (this.y < -10) this.reset();
                if (this.y < -10) this.y = canvas.height + 10;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = particleColor.replace('0.3', this.opacity);
                ctx.fill();
            }
        }

        for (let i = 0; i < 60; i++) particles.push(new Particle());

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }
        animateParticles();

        // ============ SCENE MANAGEMENT ============
        let currentScene = 0;
        const totalScenes = 7;

        function goToScene(n) {
            const current = document.getElementById('scene' + currentScene);
            const next = document.getElementById('scene' + n);
            current.classList.remove('active');
            setTimeout(() => {
                next.classList.add('active');
                currentScene = n;
                document.getElementById('progressBar').style.width = ((n / (totalScenes - 1)) * 100) + '%';
                initScene(n);
            }, 400);
        }

        function initScene(n) {
            switch(n) {
                case 1: startStorm(); break;
                case 2: break;
                case 3: showLoveCards(); break;
                case 4: initPuzzle(); break;
                case 5: showPromises(); break;
                case 6: startFinal(); break;
            }
        }

        // ============ SCENE 0: INTRO ============
        setTimeout(() => {
            document.getElementById('envelope').classList.add('opened');
            setTimeout(() => {
                document.getElementById('introText').classList.add('visible');
                document.getElementById('introName').classList.add('visible');
                setTimeout(() => {
                    document.getElementById('btnStart').classList.add('visible');
                }, 600);
            }, 500);
        }, 800);

        // ============ SCENE 1: STORM ============
        function startStorm() {
            // Create rain
            const rc = document.getElementById('rainContainer');
            rc.innerHTML = '';
            for (let i = 0; i < 80; i++) {
                const drop = document.createElement('div');
                drop.className = 'raindrop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.height = Math.random() * 20 + 15 + 'px';
                drop.style.animationDuration = Math.random() * 0.5 + 0.5 + 's';
                drop.style.animationDelay = Math.random() * 2 + 's';
                drop.style.opacity = Math.random() * 0.3 + 0.2;
                rc.appendChild(drop);
            }

            // Typewriter
            const text = "Hubo una tormenta entre nosotros.\n\nY en vez de buscarte... me qued√© quieto.\n\nNo porque no me importaras.\nNo porque no te amara.\n\nSino porque a veces, cuando todo se junta, me cierro.\n\nY s√© que eso te doli√≥, Sofi.";
            typewrite('stormText', text, () => {
                document.getElementById('btnScene1').classList.add('visible');
            });
        }

        function typewrite(elementId, text, callback) {
            const el = document.getElementById(elementId);
            el.innerHTML = '<span class="cursor"></span>';
            let i = 0;
            const lines = text.split('\n');
            let html = '';

            function type() {
                if (i < text.length) {
                    const char = text[i];
                    if (char === '\n') {
                        html += '<br>';
                    } else {
                        html += char;
                    }
                    el.innerHTML = html + '<span class="cursor"></span>';
                    i++;
                    const delay = char === '.' ? 200 : char === ',' ? 100 : char === '\n' ? 300 : 35;
                    setTimeout(type, delay);
                } else {
                    if (callback) setTimeout(callback, 500);
                }
            }
            setTimeout(type, 500);
        }

        // ============ SCENE 2: CLOUDS ============
        let cloudsRevealed = 0;

        function revealCloud(el, index) {
            if (el.classList.contains('revealed')) return;
            el.classList.add('revealed');
            cloudsRevealed++;
            document.getElementById('cloudsCounter').textContent = cloudsRevealed + ' de 3 nubes despejadas';

            // Float heart
            spawnFloatingHeart(el);

            if (cloudsRevealed >= 3) {
                setTimeout(() => {
                    const btn = document.getElementById('btnScene2');
                    btn.style.display = '';
                    btn.classList.add('visible');
                }, 600);
            }
        }

        function spawnFloatingHeart(el) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.textContent = ['üíô', 'üíú', 'ü§ç'][Math.floor(Math.random() * 3)];
            const rect = el.getBoundingClientRect();
            heart.style.left = rect.left + rect.width / 2 + 'px';
            heart.style.top = rect.top + 'px';
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 3000);
        }

        // ============ SCENE 3: LOVE CARDS ============
        function showLoveCards() {
            particleColor = 'rgba(251, 113, 133, 0.25)';
            const cards = document.querySelectorAll('.love-card');
            cards.forEach((card, i) => {
                setTimeout(() => card.classList.add('show'), 300 * i);
            });
        }

        // ============ SCENE 4: PUZZLE ============
        const puzzleEmojis = ['üíë', 'üåÖ', 'üí´', 'üè†', 'üíõ', 'üî•', 'üåô', 'üéµ', '‚ù§Ô∏è'];
        let puzzleOrder = [];
        let puzzleClicked = 0;

        function initPuzzle() {
            const grid = document.getElementById('puzzleGrid');
            grid.innerHTML = '';
            puzzleOrder = [...puzzleEmojis].sort(() => Math.random() - 0.5);

            puzzleOrder.forEach((emoji, i) => {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                piece.textContent = '?';
                piece.style.fontSize = '1.5rem';
                piece.style.color = 'rgba(255,255,255,0.3)';
                piece.onclick = () => clickPuzzlePiece(piece, emoji, i);
                grid.appendChild(piece);
            });
        }

        function clickPuzzlePiece(piece, emoji, index) {
            if (piece.classList.contains('found')) return;
            piece.classList.add('found');
            piece.textContent = emoji;
            piece.style.fontSize = '1.8rem';
            piece.style.color = '';
            puzzleClicked++;
            spawnFloatingHeart(piece);

            if (puzzleClicked >= puzzleEmojis.length) {
                setTimeout(() => {
                    document.getElementById('puzzleMessage').classList.add('visible');
                    setTimeout(() => {
                        const btn = document.getElementById('btnScene4');
                        btn.style.display = '';
                        btn.classList.add('visible');
                    }, 800);
                }, 500);
            }
        }

        // ============ SCENE 5: PROMISES ============
        function showPromises() {
            particleColor = 'rgba(134, 239, 172, 0.2)';
            const items = document.querySelectorAll('.promise-item');
            items.forEach((item, i) => {
                setTimeout(() => item.classList.add('show'), 500 * i);
            });

            setTimeout(() => {
                document.getElementById('promiseNote').classList.add('visible');
                setTimeout(() => {
                    const btn = document.getElementById('btnScene5');
                    btn.style.display = '';
                    btn.classList.add('visible');
                }, 800);
            }, 500 * items.length + 500);
        }

        // ============ SCENE 6: FINAL ============
        function startFinal() {
            particleColor = 'rgba(251, 113, 133, 0.35)';
            launchConfetti();

            const msg = "No soy perfecto, Sofi. Y probablemente nunca lo sea. Pero te amo con todo lo que soy, incluso con las partes que me cuestan. S√© que te quedas porque me amas much√≠simo, y quiero que sepas que yo estoy eligiendo quedarme tambi√©n, trabajar en lo que me cuesta, y amarte como te mereces. No con promesas grandes... sino con intenciones reales, d√≠a a d√≠a. Juntos. üíõ";

            typewrite('finalMsg', msg, null);
        }

        function launchConfetti() {
            const colors = ['#FB7185', '#F59E0B', '#C4B5FD', '#7DD3FC', '#86EFAC', '#FFE4E6'];
            for (let i = 0; i < 60; i++) {
                setTimeout(() => {
                    const piece = document.createElement('div');
                    piece.className = 'confetti-piece';
                    piece.style.left = Math.random() * 100 + '%';
                    piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                    piece.style.width = Math.random() * 8 + 5 + 'px';
                    piece.style.height = Math.random() * 8 + 5 + 'px';
                    piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                    piece.style.animationDuration = Math.random() * 2 + 2 + 's';
                    document.body.appendChild(piece);
                    setTimeout(() => piece.remove(), 4000);
                }, i * 50);
            }
        }
    </script>
</body>
</html>
