<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ü§ç</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700;800&family=Nunito:wght@300;400;500;600;700&display=swap');

        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}

        :root{
            --pink:#FF6B8A;--soft-pink:#FFD4DE;--rose:#E8487F;
            --gold:#FFB347;--warm-gold:#FFC96F;--coral:#FF8A80;
            --mint:#7DDDB3;--lila:#B39DDB;--sky:#81D4FA;
            --cream:#FFF5F5;--dark:#1a1028;--deep:#0f0a1a;
            --text:#FFFFFE;--text-soft:rgba(255,255,255,0.8);
        }

        html,body{width:100%;height:100%;overflow:hidden;font-family:'Nunito',sans-serif;font-weight:400}
        body{background:var(--deep);color:var(--text)}

        /* ============ GLOBAL TOUCH HEARTS ============ */
        .touch-heart{
            position:fixed;pointer-events:none;z-index:9999;
            animation:touchPop 1.2s ease-out forwards;font-size:1.2rem;
        }
        @keyframes touchPop{
            0%{opacity:1;transform:translateY(0) scale(1) rotate(0deg)}
            100%{opacity:0;transform:translateY(-120px) scale(0.3) rotate(25deg)}
        }

        /* ============ RIPPLE ON TAP ============ */
        .tap-ripple{
            position:fixed;pointer-events:none;z-index:9998;
            width:40px;height:40px;border-radius:50%;
            border:2px solid rgba(255,107,138,0.5);
            animation:rippleOut 0.6s ease-out forwards;
        }
        @keyframes rippleOut{
            0%{transform:translate(-50%,-50%) scale(0);opacity:1}
            100%{transform:translate(-50%,-50%) scale(3);opacity:0}
        }

        /* ============ SCENE SYSTEM ============ */
        .scene{
            position:fixed;top:0;left:0;width:100%;height:100%;
            display:flex;flex-direction:column;align-items:center;justify-content:center;
            padding:2rem 1.5rem;opacity:0;pointer-events:none;
            overflow-y:auto;overflow-x:hidden;z-index:1;
            will-change:transform,opacity;
        }
        .scene.active{opacity:1;pointer-events:all;z-index:10}
        .scene.cine-out{
            animation:cineOut 0.7s cubic-bezier(0.4,0,0.2,1) forwards;pointer-events:none;
        }
        .scene.cine-in{
            animation:cineIn 0.7s cubic-bezier(0,0,0.2,1) forwards;pointer-events:all;z-index:10;
        }
        @keyframes cineOut{
            0%{transform:scale(1);opacity:1;filter:blur(0)}
            100%{transform:scale(1.08);opacity:0;filter:blur(8px)}
        }
        @keyframes cineIn{
            0%{transform:scale(0.92);opacity:0;filter:blur(8px)}
            100%{transform:scale(1);opacity:1;filter:blur(0)}
        }

        /* ============ ANIMATED BG GRADIENTS ============ */
        .bg-animated{
            position:fixed;top:0;left:0;width:200%;height:200%;z-index:0;
            animation:bgMove 12s ease-in-out infinite alternate;
        }
        @keyframes bgMove{
            0%{transform:translate(0,0)}
            25%{transform:translate(-5%,-5%)}
            50%{transform:translate(-3%,-8%)}
            75%{transform:translate(-8%,-3%)}
            100%{transform:translate(-5%,-5%)}
        }

        .bg-intro{background:radial-gradient(ellipse at 30% 40%,#3d1c4a 0%,#2a1235 30%,#1a0a28 60%,#0f0a1a 100%)}
        .bg-storm{background:radial-gradient(ellipse at 50% 30%,#1a2040 0%,#121530 40%,#0a0e20 70%,#060812 100%)}
        .bg-truth{background:radial-gradient(ellipse at 40% 50%,#1a2545 0%,#152035 40%,#0f1528 100%)}
        .bg-love{background:radial-gradient(ellipse at 60% 40%,#3d1535 0%,#2d1028 40%,#1a0a1e 100%)}
        .bg-puzzle{background:radial-gradient(ellipse at 50% 50%,#2a1f10 0%,#1f1818 40%,#150f1a 100%)}
        .bg-future{background:radial-gradient(ellipse at 40% 60%,#2a1530 0%,#201228 40%,#150e20 100%)}
        .bg-promises{background:radial-gradient(ellipse at 50% 40%,#0f2018 0%,#0d1a15 40%,#0a1210 100%)}
        .bg-final{background:radial-gradient(ellipse at 50% 50%,#2d1035 0%,#1e0a28 40%,#0f051a 100%)}

        /* ============ AMBIENT CANVAS ============ */
        #ambientCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none}

        /* ============ PROGRESS ============ */
        .progress-bar{
            position:fixed;top:0;left:0;height:3px;z-index:999;
            transition:width 0.8s ease;border-radius:0 3px 3px 0;
            background:linear-gradient(90deg,var(--pink),var(--gold),var(--lila),var(--mint));
            background-size:300% 100%;animation:progShimmer 3s linear infinite;
        }
        @keyframes progShimmer{0%{background-position:0% 0}100%{background-position:300% 0}}

        /* ============ AUDIO BTN ============ */
        .audio-toggle{
            position:fixed;top:1rem;right:1rem;z-index:1000;
            background:rgba(255,255,255,0.1);backdrop-filter:blur(15px);
            border:1px solid rgba(255,255,255,0.15);border-radius:50%;
            width:44px;height:44px;display:flex;align-items:center;justify-content:center;
            font-size:1.1rem;cursor:pointer;transition:all 0.3s ease;color:white;
        }
        .audio-toggle:active{transform:scale(0.85)}
        .audio-toggle.on{background:rgba(255,107,138,0.2);border-color:rgba(255,107,138,0.3)}

        /* ============ üê¨ü¶Å CHARACTERS ============ */
        .duo-transition{
            position:fixed;z-index:100;pointer-events:none;
            font-size:2rem;opacity:0;
            transition:all 1.5s cubic-bezier(0.4,0,0.2,1);
        }
        .duo-transition.lion{top:50%;right:-50px}
        .duo-transition.dolphin{top:50%;left:-50px}
        .duo-transition.enter-lion{right:calc(50% - 60px);opacity:1}
        .duo-transition.enter-dolphin{left:calc(50% - 60px);opacity:1}
        .duo-transition.together-lion{right:calc(50% - 30px);opacity:1}
        .duo-transition.together-dolphin{left:calc(50% - 30px);opacity:1}
        .duo-flash{
            position:fixed;top:0;left:0;width:100%;height:100%;
            background:radial-gradient(circle at center,rgba(255,255,255,0.3),transparent 70%);
            opacity:0;z-index:99;pointer-events:none;
            transition:opacity 0.3s ease;
        }
        .duo-flash.show{opacity:1}

        /* ============ SPLASH SCREEN ============ */
        .splash{
            position:fixed;top:0;left:0;width:100%;height:100%;z-index:5000;
            background:var(--deep);display:flex;flex-direction:column;
            align-items:center;justify-content:center;
            transition:opacity 0.8s ease;
        }
        .splash.hide{opacity:0;pointer-events:none}
        .splash-emoji{font-size:2.5rem;position:absolute;transition:all 1.5s cubic-bezier(0.34,1.56,0.64,1)}
        .splash-emoji.dolphin{left:15%;top:50%;transform:translateY(-50%)}
        .splash-emoji.lion{right:15%;top:50%;transform:translateY(-50%)}
        .splash-emoji.dolphin.meet{left:calc(50% - 35px)}
        .splash-emoji.lion.meet{right:calc(50% - 35px)}
        .splash-heart{
            font-size:2rem;opacity:0;position:absolute;top:calc(50% - 40px);
            transition:all 0.6s cubic-bezier(0.175,0.885,0.32,1.275);
        }
        .splash-heart.show{opacity:1;transform:scale(1.3)}
        .splash-particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:5001}

        /* ============ SECRET MESSAGE ============ */
        .secret-msg{
            position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);
            background:rgba(15,10,26,0.95);backdrop-filter:blur(25px);
            border:1px solid var(--pink);border-radius:24px;padding:2rem 1.8rem;
            z-index:2000;text-align:center;
            transition:transform 0.5s cubic-bezier(0.175,0.885,0.32,1.275);max-width:85%;
        }
        .secret-msg.show{transform:translate(-50%,-50%) scale(1)}
        .secret-msg p{font-family:'Quicksand',sans-serif;font-size:1.1rem;font-weight:500;color:var(--soft-pink);line-height:1.7}
        .secret-msg .close-secret{
            margin-top:1.2rem;background:rgba(255,107,138,0.15);border:1px solid rgba(255,107,138,0.3);
            color:var(--pink);padding:0.6rem 1.8rem;border-radius:50px;cursor:pointer;
            font-family:'Nunito',sans-serif;font-size:0.9rem;font-weight:600;transition:all 0.3s ease;
        }
        .secret-msg .close-secret:active{transform:scale(0.93)}

        /* ============ SCENE 0: ENVELOPE (WARM START) ============ */
        .scene-intro .bg-animated{background:radial-gradient(ellipse at 30% 40%,#3d1c4a 0%,#2a1235 30%,#1a0a28 60%,#0f0a1a 100%)}

        .intro-envelope{
            width:130px;height:100px;position:relative;cursor:pointer;
            animation:bounceFloat 3s ease-in-out infinite;margin-bottom:1.8rem;
        }
        @keyframes bounceFloat{
            0%,100%{transform:translateY(0) rotate(-2deg)}
            50%{transform:translateY(-18px) rotate(2deg)}
        }
        .envelope-body{
            width:100%;height:100%;
            background:linear-gradient(135deg,#FFD4DE,#FFC1CC,#FFB3C1);
            border-radius:6px 6px 16px 16px;position:relative;
            box-shadow:0 15px 50px rgba(255,107,138,0.35),0 5px 20px rgba(255,107,138,0.2);
        }
        .envelope-flap{
            position:absolute;top:0;left:0;width:0;height:0;
            border-left:65px solid transparent;border-right:65px solid transparent;
            border-top:55px solid #FFB3C1;transform-origin:top center;
            transition:transform 0.8s cubic-bezier(0.34,1.56,0.64,1);
        }
        .intro-envelope.opened .envelope-flap{transform:rotateX(180deg)}
        .envelope-heart{
            position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
            font-size:2.4rem;cursor:pointer;z-index:2;
        }
        .envelope-heart-inner{animation:heartPulse 1.2s ease-in-out infinite}
        @keyframes heartPulse{0%,100%{transform:scale(1)}30%{transform:scale(1.2)}60%{transform:scale(1)}}

        .intro-label{
            font-family:'Quicksand',sans-serif;font-size:1.15rem;font-weight:500;
            color:var(--soft-pink);opacity:0;text-align:center;
            transition:all 0.8s ease;transform:translateY(10px);
        }
        .intro-label.visible{opacity:1;transform:translateY(0)}

        .intro-name{
            font-family:'Poppins',sans-serif;font-size:2.2rem;font-weight:700;
            background:linear-gradient(135deg,var(--pink),var(--gold),var(--pink));
            background-size:200% auto;animation:shimmerText 3s linear infinite;
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;
            margin:0.4rem 0 1.5rem;opacity:0;
            transition:all 0.8s ease;transform:translateY(10px);
        }
        .intro-name.visible{opacity:1;transform:translateY(0)}
        @keyframes shimmerText{0%{background-position:0% center}100%{background-position:200% center}}

        .btn-main{
            background:linear-gradient(135deg,var(--pink),var(--rose));color:white;border:none;
            padding:1rem 2.5rem;border-radius:50px;font-family:'Poppins',sans-serif;
            font-size:1rem;font-weight:600;cursor:pointer;opacity:0;
            transition:all 0.4s ease;transform:translateY(10px);
            box-shadow:0 8px 30px rgba(232,72,127,0.4);letter-spacing:0.3px;
            position:relative;overflow:hidden;
        }
        .btn-main::after{
            content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
            background:linear-gradient(45deg,transparent,rgba(255,255,255,0.15),transparent);
            animation:btnShine 3s ease-in-out infinite;
        }
        @keyframes btnShine{0%{transform:translateX(-100%) rotate(45deg)}100%{transform:translateX(100%) rotate(45deg)}}
        .btn-main.visible{opacity:1;transform:translateY(0);animation:btnBounce 2s ease-in-out infinite}
        @keyframes btnBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
        .btn-main:active{transform:scale(0.94) !important}

        /* ============ SCENE 1: STORM ============ */
        .rain-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden;z-index:1}
        .raindrop{
            position:absolute;top:-20px;width:2px;
            background:linear-gradient(to bottom,transparent,rgba(129,212,250,0.4));
            border-radius:0 0 2px 2px;animation:fall linear infinite;
        }
        @keyframes fall{to{transform:translateY(110vh)}}

        .lightning{
            position:fixed;top:0;left:0;width:100%;height:100%;
            background:radial-gradient(circle at var(--lx,50%) var(--ly,30%),rgba(179,157,219,0.15),transparent 60%);
            opacity:0;z-index:2;pointer-events:none;
        }
        .lightning.flash{animation:lightFlash 0.2s ease}
        @keyframes lightFlash{0%{opacity:0}40%{opacity:1}100%{opacity:0}}

        .rain-touch-msg{
            position:fixed;bottom:18%;left:50%;transform:translateX(-50%);
            font-family:'Quicksand',sans-serif;font-size:1.3rem;font-weight:600;
            color:var(--soft-pink);opacity:0;transition:opacity 0.4s ease;
            z-index:50;pointer-events:none;
            text-shadow:0 0 25px rgba(255,107,138,0.6);
        }
        .rain-touch-msg.show{opacity:1;animation:msgPop 0.4s ease}
        @keyframes msgPop{0%{transform:translateX(-50%) scale(0.8)}100%{transform:translateX(-50%) scale(1)}}

        .storm-emoji{font-size:3.2rem;margin-bottom:0.8rem;z-index:3;position:relative;animation:bounceFloat 3s ease-in-out infinite}
        .storm-title{
            font-family:'Poppins',sans-serif;font-size:1.7rem;font-weight:700;
            text-align:center;margin-bottom:1rem;z-index:3;position:relative;
            color:var(--lila);animation:gentleTremble 3s ease-in-out infinite;
        }
        @keyframes gentleTremble{
            0%,100%{transform:translate(0,0)}
            20%{transform:translate(-1px,0.5px)}
            40%{transform:translate(0.5px,-0.5px)}
            60%{transform:translate(-0.5px,0.5px)}
            80%{transform:translate(1px,-0.5px)}
        }
        .typewriter{
            font-family:'Nunito',sans-serif;font-size:1.02rem;font-weight:400;
            line-height:1.9;text-align:center;color:var(--text-soft);
            max-width:550px;min-height:140px;z-index:3;position:relative;
        }
        .typewriter .cursor{
            display:inline-block;width:2px;height:1.1em;background:var(--pink);
            margin-left:2px;vertical-align:text-bottom;animation:blink .7s step-end infinite;
        }
        @keyframes blink{50%{opacity:0}}

        .scene-btn{
            background:rgba(255,255,255,0.06);backdrop-filter:blur(12px);
            color:white;border:1px solid rgba(255,255,255,0.12);
            padding:0.9rem 2rem;border-radius:50px;font-family:'Poppins',sans-serif;
            font-size:0.9rem;font-weight:500;cursor:pointer;margin-top:1.5rem;
            transition:all 0.3s ease;opacity:0;z-index:3;position:relative;
        }
        .scene-btn.visible{opacity:1;animation:btnBounce 2.5s ease-in-out infinite}
        .scene-btn:active{transform:scale(0.93);background:rgba(255,255,255,0.12)}

        /* ============ SCENE 2: TRUTH (CLOUDS) ============ */
        .section-title{
            font-family:'Poppins',sans-serif;font-size:1.7rem;font-weight:700;
            text-align:center;margin-bottom:0.2rem;
        }
        .section-subtitle{
            font-family:'Quicksand',sans-serif;font-size:1rem;font-weight:500;
            color:rgba(255,255,255,0.4);margin-bottom:1.5rem;text-align:center;
        }
        .clouds-area{
            position:relative;width:100%;max-width:500px;display:flex;
            flex-direction:column;align-items:center;gap:0.8rem;z-index:3;
        }
        .cloud-card{
            background:rgba(255,255,255,0.04);backdrop-filter:blur(12px);
            border:1px solid rgba(255,255,255,0.08);border-radius:22px;
            padding:1.2rem 1.4rem;width:92%;cursor:pointer;transition:all 0.5s ease;
            position:relative;overflow:hidden;
        }
        .cloud-card::before{
            content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,0.05),transparent);
            transition:left 0.6s ease;
        }
        .cloud-card.revealed::before{left:100%}
        .cloud-card.revealed{
            background:rgba(129,212,250,0.06);border-color:rgba(129,212,250,0.2);
            transform:scale(1.02);
        }
        .cloud-label{
            font-family:'Poppins',sans-serif;font-size:0.8rem;font-weight:600;
            text-transform:uppercase;letter-spacing:1.5px;color:var(--sky);
            margin-bottom:0.5rem;display:flex;align-items:center;gap:0.5rem;
        }
        .cloud-text{
            font-family:'Nunito',sans-serif;font-size:0.95rem;font-weight:400;
            line-height:1.7;color:var(--text-soft);max-height:0;overflow:hidden;
            transition:max-height 0.7s cubic-bezier(0.4,0,0.2,1),opacity 0.5s ease;opacity:0;
        }
        .cloud-card.revealed .cloud-text{max-height:300px;opacity:1}
        .cloud-tap{
            font-family:'Nunito',sans-serif;font-size:0.75rem;
            color:rgba(255,255,255,0.25);text-align:center;margin-top:0.3rem;
            transition:all 0.3s ease;
        }
        .cloud-card.revealed .cloud-tap{opacity:0;height:0;margin:0}
        .clouds-counter{font-family:'Quicksand',sans-serif;font-size:0.85rem;color:rgba(255,255,255,0.3);margin-top:0.8rem}

        /* ============ SCENE 3: LOVE CARDS ============ */
        .love-carousel{
            display:flex;flex-direction:column;gap:0.9rem;width:100%;max-width:500px;
            max-height:52vh;overflow-y:auto;padding:0.5rem;scrollbar-width:none;z-index:3;
        }
        .love-carousel::-webkit-scrollbar{display:none}
        .love-card{
            background:linear-gradient(135deg,rgba(255,107,138,0.08),rgba(255,179,55,0.05));
            border:1px solid rgba(255,107,138,0.12);border-radius:22px;
            padding:1.2rem 1.4rem;transform:translateY(40px) scale(0.95);opacity:0;
            transition:all 0.7s cubic-bezier(0.34,1.56,0.64,1);
        }
        .love-card.show{transform:translateY(0) scale(1);opacity:1}
        .love-card-emoji{font-size:1.5rem;margin-bottom:0.4rem}
        .love-card-text{
            font-family:'Quicksand',sans-serif;font-size:0.95rem;font-weight:500;
            line-height:1.7;color:var(--text-soft);
        }
        .love-card-ref{
            font-family:'Nunito',sans-serif;font-size:0.75rem;
            color:rgba(255,255,255,0.3);margin-top:0.5rem;font-weight:600;
        }

        /* PETALS */
        .petal{
            position:fixed;pointer-events:none;z-index:2;
            width:12px;height:12px;border-radius:50% 0 50% 50%;
            animation:petalDrift linear forwards;
        }
        @keyframes petalDrift{
            0%{transform:translateY(-20px) rotate(0deg);opacity:0.7}
            50%{transform:translateY(50vh) rotate(180deg) translateX(30px);opacity:0.5}
            100%{transform:translateY(105vh) rotate(360deg) translateX(-20px);opacity:0}
        }

        /* ============ SCENE 4: PUZZLE ============ */
        .puzzle-grid{
            display:grid;grid-template-columns:repeat(3,1fr);gap:10px;
            width:270px;height:270px;margin-bottom:1.2rem;z-index:3;position:relative;
        }
        .puzzle-piece{
            background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);
            border-radius:16px;display:flex;align-items:center;justify-content:center;
            font-size:2rem;cursor:pointer;transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);
            user-select:none;position:relative;overflow:hidden;
        }
        .puzzle-piece .silhouette{
            font-size:2rem;filter:blur(6px) brightness(0.3);transition:all 0.4s ease;
        }
        .puzzle-piece.found .silhouette{filter:blur(0) brightness(1)}
        .puzzle-piece.found{
            background:linear-gradient(135deg,rgba(255,107,138,0.12),rgba(255,179,55,0.08));
            border-color:rgba(255,107,138,0.25);
        }
        .puzzle-piece.lion-found{
            animation:lionRoar 0.6s ease !important;
            border-color:var(--gold) !important;
            box-shadow:0 0 25px rgba(255,179,55,0.5);
        }
        @keyframes lionRoar{
            0%{transform:scale(1)}
            20%{transform:scale(1.2) rotate(-5deg)}
            40%{transform:scale(1.15) rotate(5deg)}
            60%{transform:scale(1.1) rotate(-3deg)}
            100%{transform:scale(1) rotate(0deg)}
        }
        .puzzle-piece.dolphin-found{
            animation:dolphinSplash 0.6s ease !important;
            border-color:var(--sky) !important;
            box-shadow:0 0 25px rgba(129,212,250,0.5);
        }
        @keyframes dolphinSplash{
            0%{transform:scale(1) translateY(0)}
            30%{transform:scale(1.15) translateY(-15px)}
            60%{transform:scale(1.1) translateY(5px)}
            100%{transform:scale(1) translateY(0)}
        }
        .puzzle-piece.fly-to-center{
            position:fixed !important;z-index:200;
            transition:all 1s cubic-bezier(0.34,1.56,0.64,1) !important;
        }

        .puzzle-duo{
            font-size:2.5rem;margin:0.5rem 0;opacity:0;z-index:3;position:relative;
            transition:all 0.8s cubic-bezier(0.175,0.885,0.32,1.275);
        }
        .puzzle-duo.show{opacity:1;animation:duoPulse 2s ease-in-out infinite}
        @keyframes duoPulse{
            0%,100%{text-shadow:0 0 15px rgba(255,255,255,0.2);transform:scale(1)}
            50%{text-shadow:0 0 35px rgba(255,255,255,0.5),0 0 60px rgba(255,107,138,0.3);transform:scale(1.08)}
        }

        .puzzle-message{
            font-family:'Quicksand',sans-serif;font-size:1rem;font-weight:500;
            text-align:center;color:var(--warm-gold);opacity:0;
            transition:opacity 0.8s ease;max-width:380px;line-height:1.7;z-index:3;
        }
        .puzzle-message.visible{opacity:1}

        /* ============ SCENE 5: FUTURE ============ */
        .future-grid{
            display:flex;flex-direction:column;gap:0.8rem;width:100%;max-width:500px;z-index:3;
        }
        .future-card{
            background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);
            border-radius:20px;padding:1rem 1.2rem;cursor:pointer;
            transition:all 0.6s cubic-bezier(0.34,1.56,0.64,1);
            transform:translateX(-30px) scale(0.95);opacity:0;
            display:flex;align-items:center;gap:1rem;
        }
        .future-card.show{transform:translateX(0) scale(1);opacity:1}
        .future-card.tapped{
            background:linear-gradient(135deg,rgba(255,179,55,0.08),rgba(255,107,138,0.06));
            border-color:rgba(255,179,55,0.25);transform:scale(1.02) !important;
        }
        .future-card-emoji{font-size:2rem;flex-shrink:0;transition:transform 0.3s ease}
        .future-card.tapped .future-card-emoji{animation:emojiPop 0.5s ease}
        @keyframes emojiPop{0%{transform:scale(1)}50%{transform:scale(1.4) rotate(10deg)}100%{transform:scale(1)}}
        .future-card-text{
            font-family:'Poppins',sans-serif;font-size:0.95rem;font-weight:500;
            color:var(--text-soft);line-height:1.5;
        }
        .future-card-hidden{
            font-family:'Quicksand',sans-serif;font-size:0.88rem;font-weight:500;
            color:var(--warm-gold);max-height:0;overflow:hidden;
            transition:max-height 0.5s ease,margin 0.3s ease;margin-top:0;
        }
        .future-card.tapped .future-card-hidden{max-height:100px;margin-top:0.5rem}

        /* ============ SCENE 6: PROMISES ============ */
        .promises-list{display:flex;flex-direction:column;gap:0.8rem;width:100%;max-width:500px;z-index:3}
        .promise-item{
            display:flex;align-items:flex-start;gap:1rem;
            background:rgba(125,221,179,0.04);border:1px solid rgba(125,221,179,0.1);
            border-radius:18px;padding:1rem 1.2rem;opacity:0;
            transform:translateY(20px);transition:all 0.6s cubic-bezier(0.34,1.56,0.64,1);
            position:relative;
        }
        .promise-item.show{opacity:1;transform:translateY(0)}
        .promise-icon{font-size:1.3rem;flex-shrink:0;margin-top:2px}
        .promise-text{
            font-family:'Nunito',sans-serif;font-size:0.92rem;font-weight:400;
            line-height:1.7;color:var(--text-soft);
        }
        .promise-check{
            position:absolute;top:0.8rem;right:0.8rem;font-size:1.1rem;
            opacity:0;transform:scale(0) rotate(-180deg);
            transition:all 0.5s cubic-bezier(0.175,0.885,0.32,1.275);
        }
        .promise-item.checked .promise-check{opacity:1;transform:scale(1) rotate(0deg)}
        .promise-note{
            font-family:'Quicksand',sans-serif;font-size:0.88rem;font-weight:500;
            color:rgba(255,255,255,0.35);text-align:center;margin-top:1.2rem;
            max-width:400px;line-height:1.6;opacity:0;transition:opacity 0.8s ease;
            z-index:3;
        }
        .promise-note.visible{opacity:1}

        /* ============ SCENE 7: WRITE ME ============ */
        .scene-write{z-index:10}
        .write-paper{
            background:rgba(255,255,255,0.04);backdrop-filter:blur(12px);
            border:1px solid rgba(255,255,255,0.1);border-radius:24px;
            padding:2rem 1.5rem;width:92%;max-width:450px;text-align:center;z-index:3;
            position:relative;
        }
        .write-lines{
            position:absolute;top:0;left:0;width:100%;height:100%;
            pointer-events:none;overflow:hidden;border-radius:24px;
        }
        .write-line{
            width:85%;height:1px;background:rgba(255,255,255,0.04);
            margin:2.2rem auto 0;
        }
        .write-emoji{font-size:2.5rem;margin-bottom:1rem;animation:bounceFloat 3s ease-in-out infinite}
        .write-title{
            font-family:'Poppins',sans-serif;font-size:1.3rem;font-weight:600;
            color:var(--soft-pink);margin-bottom:0.5rem;
        }
        .write-subtitle{
            font-family:'Nunito',sans-serif;font-size:0.9rem;font-weight:400;
            color:rgba(255,255,255,0.4);margin-bottom:1.5rem;line-height:1.5;
        }
        .write-textarea{
            width:100%;min-height:100px;background:rgba(255,255,255,0.03);
            border:1px solid rgba(255,255,255,0.1);border-radius:16px;
            padding:1rem;color:var(--text-soft);font-family:'Nunito',sans-serif;
            font-size:0.95rem;resize:none;outline:none;
            transition:border-color 0.3s ease;
        }
        .write-textarea:focus{border-color:rgba(255,107,138,0.4)}
        .write-textarea::placeholder{color:rgba(255,255,255,0.2)}
        .btn-copy{
            margin-top:1.2rem;background:linear-gradient(135deg,var(--pink),var(--rose));
            color:white;border:none;padding:0.9rem 2rem;border-radius:50px;
            font-family:'Poppins',sans-serif;font-size:0.9rem;font-weight:600;
            cursor:pointer;transition:all 0.3s ease;
            box-shadow:0 6px 25px rgba(232,72,127,0.3);
        }
        .btn-copy:active{transform:scale(0.93)}

        /* ============ SCENE 8: FINAL ============ */
        .final-heart{font-size:4rem;margin-bottom:0.8rem;animation:heartbeat 1.3s ease-in-out infinite;z-index:3;position:relative}
        @keyframes heartbeat{0%,100%{transform:scale(1)}15%{transform:scale(1.18)}30%{transform:scale(1)}45%{transform:scale(1.12)}}
        .final-title{
            font-family:'Poppins',sans-serif;font-size:1.9rem;font-weight:700;
            text-align:center;z-index:3;position:relative;
            background:linear-gradient(135deg,var(--pink),var(--gold),var(--lila));
            background-size:200% auto;animation:shimmerText 4s linear infinite;
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;
            margin-bottom:0.5rem;line-height:1.3;
        }
        .final-message{
            font-family:'Nunito',sans-serif;font-size:0.95rem;font-weight:400;
            line-height:1.9;text-align:center;color:var(--text-soft);
            max-width:480px;margin-bottom:1.2rem;min-height:100px;z-index:3;position:relative;
        }
        .spotify-embed{
            border-radius:12px;overflow:hidden;margin-bottom:0.8rem;
            opacity:0;transition:opacity 0.8s ease;z-index:3;position:relative;
        }
        .spotify-embed.visible{opacity:1}
        .btn-copy-wha{
            background:rgba(255,255,255,0.06);backdrop-filter:blur(12px);
            color:white;border:1px solid rgba(255,255,255,0.12);
            padding:0.9rem 2rem;border-radius:50px;font-family:'Poppins',sans-serif;
            font-size:0.9rem;font-weight:500;cursor:pointer;transition:all 0.3s ease;
            display:flex;align-items:center;gap:0.5rem;z-index:3;position:relative;
            opacity:0;
        }
        .btn-copy-wha.visible{opacity:1}
        .btn-copy-wha:active{transform:scale(0.93);background:rgba(255,255,255,0.12)}

        /* TOAST */
        .toast{
            position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(20px);
            background:rgba(255,107,138,0.9);backdrop-filter:blur(10px);
            color:white;padding:0.8rem 1.5rem;border-radius:50px;
            font-family:'Poppins',sans-serif;font-size:0.85rem;font-weight:500;
            z-index:3000;opacity:0;transition:all 0.4s ease;pointer-events:none;
        }
        .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

        .final-footer{
            position:fixed;bottom:1.2rem;z-index:10;
            font-family:'Quicksand',sans-serif;font-size:0.85rem;font-weight:500;
            color:rgba(255,255,255,0.2);
        }
        .btn-replay{
            position:fixed;bottom:3rem;right:1.5rem;z-index:10;
            background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);
            width:40px;height:40px;border-radius:50%;display:flex;
            align-items:center;justify-content:center;font-size:1rem;
            cursor:pointer;opacity:0;transition:all 0.3s ease;
        }
        .btn-replay.visible{opacity:1}
        .btn-replay:active{transform:scale(0.9) rotate(-180deg)}

        /* STARS */
        .star{
            position:fixed;border-radius:50%;background:white;pointer-events:none;z-index:2;
            animation:starTwinkle 3s ease-in-out infinite;
        }
        @keyframes starTwinkle{0%,100%{opacity:0.15;transform:scale(1)}50%{opacity:0.7;transform:scale(1.3)}}

        /* CONFETTI */
        .confetti-piece{
            position:fixed;top:-20px;z-index:100;
            animation:confettiFall linear forwards;pointer-events:none;
        }
        @keyframes confettiFall{
            0%{transform:translateY(0) rotate(0deg) scale(1);opacity:1}
            80%{opacity:0.8}
            100%{transform:translateY(110vh) rotate(720deg) scale(0.5);opacity:0}
        }

        /* FLOATING HEARTS */
        .floating-heart{position:fixed;pointer-events:none;z-index:50;animation:floatUp 2.5s ease-out forwards}
        @keyframes floatUp{
            0%{opacity:1;transform:translateY(0) scale(1) rotate(0deg)}
            100%{opacity:0;transform:translateY(-150px) scale(0.2) rotate(30deg)}
        }

        /* HEART PARTICLES FINAL */
        .heart-particle{
            position:fixed;pointer-events:none;z-index:2;
            animation:heartRise linear forwards;
        }
        @keyframes heartRise{
            0%{opacity:0.6;transform:translateY(0) scale(1) rotate(0deg)}
            100%{opacity:0;transform:translateY(-350px) scale(0.15) rotate(50deg)}
        }
    </style>
</head>

    <body>
    <!-- Progress -->
    <div class="progress-bar" id="progressBar" style="width:0%"></div>
    <!-- Audio -->
    <div class="audio-toggle" id="audioToggle" onclick="toggleAudio()">üîá</div>
    <!-- Canvas -->
    <canvas id="ambientCanvas"></canvas>
    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- üê¨ü¶Å CHARACTERS -->
    <div class="duo-transition dolphin" id="duoDolphin">üê¨</div>
    <div class="duo-transition lion" id="duoLion">ü¶Å</div>
    <div class="duo-flash" id="duoFlash"></div>

    <!-- SPLASH -->
    <div class="splash" id="splash">
        <div class="splash-emoji dolphin" id="splashDolphin">üê¨</div>
        <div class="splash-emoji lion" id="splashLion">ü¶Å</div>
        <div class="splash-heart" id="splashHeart">ü§ç</div>
    </div>

    <!-- SECRET -->
    <div class="secret-msg" id="secretMsg">
        <p>Sab√≠a que ibas a tocar m√°s de una vez üòè<br><br>Te conozco, mi amor ü§ç</p>
        <button class="close-secret" onclick="document.getElementById('secretMsg').classList.remove('show')">ya pues üíõ</button>
    </div>

    <!-- ===== SCENE 0: ENVELOPE ===== -->
    <div class="scene scene-intro" id="scene0">
        <div class="bg-animated bg-intro"></div>
        <div class="intro-envelope" id="envelope" style="z-index:3;position:relative">
            <div class="envelope-body">
                <div class="envelope-flap"></div>
                <div class="envelope-heart" id="envelopeHeart">
                    <span class="envelope-heart-inner">üíå</span>
                </div>
            </div>
        </div>
        <p class="intro-label" id="introLabel">Esto es para ti...</p>
        <h1 class="intro-name" id="introName">Mi leoncita ü¶Å</h1>
        <button class="btn-main" id="btnStart" onclick="goToScene(1)">Abrir mi coraz√≥n</button>
    </div>

    <!-- ===== SCENE 1: STORM ===== -->
    <div class="scene scene-storm" id="scene1">
        <div class="bg-animated bg-storm"></div>
        <div class="rain-container" id="rainContainer"></div>
        <div class="lightning" id="lightning"></div>
        <div class="rain-touch-msg" id="rainTouchMsg">Te extra√±√©... ü§ç</div>
        <div class="storm-emoji">üåßÔ∏è</div>
        <h2 class="storm-title">La Tormenta</h2>
        <div class="typewriter" id="stormText"></div>
        <button class="scene-btn" id="btnScene1" onclick="goToScene(2)">¬øQu√© pas√≥ realmente? ‚Üí</button>
    </div>

    <!-- ===== SCENE 2: TRUTH ===== -->
    <div class="scene scene-truth" id="scene2">
        <div class="bg-animated bg-truth"></div>
        <h2 class="section-title" style="color:var(--sky)">Lo que no te dije</h2>
        <p class="section-subtitle">Toca cada nube para despejarla ‚òÅÔ∏è</p>
        <div class="clouds-area">
            <div class="cloud-card" onclick="revealCloud(this,0)">
                <div class="cloud-label">‚òÅÔ∏è La verdad es que...</div>
                <div class="cloud-text">No fue que no me importara, mi amor. Me puse bravo. Y cuando me pongo as√≠, me cierro. No soy de buscar, y s√© que eso no est√° bien. Pero que no haya ido por ti no significa que no me doliera verte irte, preciosa.</div>
                <div class="cloud-tap">toca para revelar</div>
            </div>
            <div class="cloud-card" onclick="revealCloud(this,1)">
                <div class="cloud-label">üå´Ô∏è Lo que sent√≠...</div>
                <div class="cloud-text">No fue solo ese momento, princesa. Eran cositas que se ven√≠an acumulando en los √∫ltimos d√≠as, y cuando todo se junt√≥... explot√© qued√°ndome callado en vez de hablarlo. Y encima la ansiedad por cosas que quiero lograr me ten√≠a la cabeza en mil.</div>
                <div class="cloud-tap">toca para revelar</div>
            </div>
            <div class="cloud-card" onclick="revealCloud(this,2)">
                <div class="cloud-label">üí≠ Lo que necesito que sepas...</div>
                <div class="cloud-text">Que me cuesta much√≠simo, beb√© linda. Me cuesta hablar de estas cosas, abrirme cuando hay conflicto. Tu forma de resolver es diferente a la m√≠a, y a veces no s√© c√≥mo llegar a ti. Pero estoy aqu√≠, intent√°ndolo... a mi manera. Aprendiendo. Por ti. Por nosotros.</div>
                <div class="cloud-tap">toca para revelar</div>
            </div>
        </div>
        <p class="clouds-counter" id="cloudsCounter">0 de 3 nubes despejadas</p>
        <button class="scene-btn" id="btnScene2" onclick="goToScene(3)" style="display:none">Hay m√°s que quiero decirte ‚Üí</button>
    </div>

    <!-- ===== SCENE 3: LOVE ===== -->
    <div class="scene scene-love" id="scene3">
        <div class="bg-animated bg-love"></div>
        <h2 class="section-title" style="color:var(--pink)">Lo que siento por ti</h2>
        <p class="section-subtitle">Cada una es real, princesa ‚ú®</p>
        <div class="love-carousel" id="loveCarousel">
            <div class="love-card">
                <div class="love-card-emoji">üåô</div>
                <div class="love-card-text">"S√© que te quedas porque me amas con todo, mi amor. Y quiero que sepas que yo tambi√©n te amo as√≠. Con todo y mis silencios."</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">üèÆ</div>
                <div class="love-card-text">"T√∫ eres la luz que no sab√≠a que necesitaba, preciosa. Antes de ti, todo estaba oscuro y yo ni cuenta me daba."</div>
                <div class="love-card-ref">‚Äî como Rapunzel encontrando las luces ‚ú®</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">ü¶Å</div>
                <div class="love-card-text">"Me recuerdas qui√©n soy cuando lo olvido, leoncita. Cuando me pierdo, t√∫ eres mi camino de vuelta."</div>
                <div class="love-card-ref">‚Äî como Nala le recuerda a Simba qui√©n es üåÖ</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">üè†</div>
                <div class="love-card-text">"Me proyecto contigo. No lo digo por decir, morenita hermosa. Lo siento cada vez que pienso en el futuro y t√∫ est√°s en todos los escenarios."</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">ü§ñ</div>
                <div class="love-card-text">"A veces no tengo las palabras perfectas, beb√© linda. Pero lo que siento por ti no necesita palabras. Se siente."</div>
                <div class="love-card-ref">‚Äî como Wall-E, que amaba sin poder decirlo üå±</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">üéà</div>
                <div class="love-card-text">"Contigo, mi amor, la aventura m√°s grande es el d√≠a a d√≠a. Los lunes, los martes, hasta los d√≠as malos... contigo todo vale."</div>
                <div class="love-card-ref">‚Äî como Carl y Ellie, lo extraordinario est√° en lo simple üè°</div>
            </div>
            <div class="love-card">
                <div class="love-card-emoji">üê¨ü¶Å</div>
                <div class="love-card-text">"Un delf√≠n y una leona. Suena loco, ¬øno? Pero as√≠ somos. Diferentes, raros, y perfectos juntos. Te amo con todo, princesa."</div>
            </div>
        </div>
        <button class="scene-btn visible" onclick="goToScene(4)" style="margin-top:1rem;z-index:3;position:relative">A√∫n hay algo m√°s ‚Üí</button>
    </div>

    <!-- ===== SCENE 4: PUZZLE ===== -->
    <div class="scene scene-puzzle" id="scene4">
        <div class="bg-animated bg-puzzle"></div>
        <h2 class="section-title" style="color:var(--warm-gold)">üß© Juntando las piezas</h2>
        <p class="section-subtitle">Toca las piezas para descubrir qui√©nes somos</p>
        <div class="puzzle-grid" id="puzzleGrid"></div>
        <div class="puzzle-duo" id="puzzleDuo">üê¨ + ü¶Å = ü§ç</div>
        <p class="puzzle-message" id="puzzleMessage">"A veces las piezas se desordenan, mi amor... pero siempre encajan cuando estamos juntos. Porque as√≠ somos t√∫ y yo."</p>
        <button class="scene-btn" id="btnScene4" onclick="goToScene(5)" style="display:none">Mira lo que veo para nosotros ‚Üí</button>
    </div>

    <!-- ===== SCENE 5: FUTURE ===== -->
    <div class="scene scene-future" id="scene5">
        <div class="bg-animated bg-future"></div>
        <h2 class="section-title" style="color:var(--warm-gold)">Nosotros en el futuro</h2>
        <p class="section-subtitle">Toca cada sue√±o, princesa ‚ú®</p>
        <div class="future-grid" id="futureGrid">
            <div class="future-card" onclick="tapFuture(this)">
                <div class="future-card-emoji">üè°</div>
                <div>
                    <div class="future-card-text">Nuestra casa</div>
                    <div class="future-card-hidden">Con la cocina donde te voy a hacer re√≠r todas las ma√±anas, mi amor üíõ</div>
                </div>
            </div>
            <div class="future-card" onclick="tapFuture(this)">
                <div class="future-card-emoji">‚úàÔ∏è</div>
                <div>
                    <div class="future-card-text">Ese viaje que so√±amos</div>
                    <div class="future-card-hidden">T√∫ y yo perdidos en alg√∫n lugar del mundo, siendo nosotros, preciosa üåç</div>
                </div>
            </div>
            <div class="future-card" onclick="tapFuture(this)">
                <div class="future-card-emoji">üê∂</div>
                <div>
                    <div class="future-card-text">Nuestra mascota</div>
                    <div class="future-card-hidden">Un animalito tan loco como nosotros, leoncita üêæ</div>
                </div>
            </div>
            <div class="future-card" onclick="tapFuture(this)">
                <div class="future-card-emoji">ü™Ñ</div>
                <div>
                    <div class="future-card-text">Un mundo ideal</div>
                    <div class="future-card-hidden">No necesito una alfombra m√°gica, beb√© linda. Contigo cualquier lugar es un mundo ideal üí´</div>
                </div>
            </div>
            <div class="future-card" onclick="tapFuture(this)">
                <div class="future-card-emoji">üë¥üëµ</div>
                <div>
                    <div class="future-card-text">Envejecer juntos</div>
                    <div class="future-card-hidden">Siendo desastrosos, peleando por el control y am√°ndonos hasta el √∫ltimo d√≠a, morenita hermosa ü§ç</div>
                </div>
            </div>
        </div>
        <button class="scene-btn" id="btnScene5" onclick="goToScene(6)" style="display:none">Lo que voy a hacer por nosotros ‚Üí</button>
    </div>

    <!-- ===== SCENE 6: PROMISES ===== -->
    <div class="scene scene-promises" id="scene6">
        <div class="bg-animated bg-promises"></div>
        <h2 class="section-title" style="color:var(--mint)">No son promesas</h2>
        <p class="section-subtitle">Son intenciones reales, con altibajos incluidos</p>
        <div class="promises-list" id="promisesList">
            <div class="promise-item">
                <div class="promise-icon">üö∂</div>
                <div class="promise-text">Voy a aprender a buscarte, mi amor. Aunque est√© bravo, aunque me cueste. Porque quedarme quieto no significa que no me importe.</div>
                <div class="promise-check">‚úì</div>
            </div>
            <div class="promise-item">
                <div class="promise-icon">üó£Ô∏è</div>
                <div class="promise-text">Voy a intentar hablar m√°s, princesa. Aunque no me salga perfecto. Prefiero decirlo mal a no decir nada.</div>
                <div class="promise-check">‚úì</div>
            </div>
            <div class="promise-item">
                <div class="promise-icon">ü§ù</div>
                <div class="promise-text">Quiero que resolvamos juntos, no uno contra el otro. Tu forma de sentir importa, beb√© linda. Y la m√≠a tambi√©n.</div>
                <div class="promise-check">‚úì</div>
            </div>
            <div class="promise-item">
                <div class="promise-icon">üåä</div>
                <div class="promise-text">Habr√° d√≠as dif√≠ciles, leoncita. No voy a ser perfecto, y probablemente la riegue otra vez. Pero voy a estar. Siempre voy a estar.</div>
                <div class="promise-check">‚úì</div>
            </div>
            <div class="promise-item">
                <div class="promise-icon">ü§ç</div>
                <div class="promise-text">Esto no es un contrato, morenita hermosa. No es algo para sacarnos en cara despu√©s. Es mi forma de decirte que estoy trabajando en m√≠... por nosotros.</div>
                <div class="promise-check">‚úì</div>
            </div>
        </div>
        <p class="promise-note" id="promiseNote">No te pido que sea f√°cil. Solo que lo intentemos juntos, mi amor. ü§ç</p>
        <button class="scene-btn" id="btnScene6" onclick="goToScene(7)" style="display:none">Algo m√°s para ti ‚Üí</button>
    </div>

    <!-- ===== SCENE 7: WRITE ME ===== -->
    <div class="scene scene-write" id="scene7">
        <div class="bg-animated bg-love"></div>
        <div class="write-paper">
            <div class="write-lines">
                <div class="write-line"></div><div class="write-line"></div>
                <div class="write-line"></div><div class="write-line"></div>
                <div class="write-line"></div><div class="write-line"></div>
            </div>
            <div class="write-emoji">üìù</div>
            <h3 class="write-title">¬øQuieres decirme algo, mi amor?</h3>
            <p class="write-subtitle">Este es tu espacio. Escribe lo que sientas, princesa. Es solo para ti... y cuando quieras, me lo muestras. ü§ç</p>
            <textarea class="write-textarea" id="writeArea" placeholder="Escribe aqu√≠ lo que sientas..." rows="4"></textarea>
            <button class="btn-copy" onclick="saveNote()">Guardar en mi coraz√≥n üíõ</button>
        </div>
        <button class="scene-btn visible" onclick="goToScene(8)" style="margin-top:1.5rem">Un √∫ltimo paso ‚Üí</button>
    </div>

    <!-- ===== SCENE 8: FINAL ===== -->
    <div class="scene scene-final" id="scene8">
        <div class="bg-animated bg-final"></div>
        <div class="final-heart">‚ù§Ô∏è</div>
        <h2 class="final-title">Te elijo a ti.<br>Hoy y siempre, mi leoncita.</h2>
        <p class="final-message" id="finalMsg"></p>
        <div class="spotify-embed" id="spotifyEmbed">
            <iframe src="https://open.spotify.com/embed/track/5Nm9ERjJZ5oyfXZTECKmRt?theme=0" width="300" height="80" frameborder="0" allow="encrypted-media" style="border-radius:12px"></iframe>
        </div>
        <button class="btn-copy-wha" id="btnCopyWha" onclick="copyWhaMsg()">
            ü§ç Escr√≠beme, mi amor
        </button>
        <button class="btn-replay" id="btnReplay" onclick="replayAll()">üîÑ</button>
        <p class="final-footer">hecho con el üíõ ‚Äî de tu üê¨ para su ü¶Å</p>
    </div>

    <!-- ============================================= -->
    <!-- ================== JAVASCRIPT =============== -->
    <!-- ============================================= -->
    <script>
    // ============ CONFIG ============
    const WHA_MSG = 'Mi amor, ya vi lo que hiciste... ü§çüê¨';

    // ============ GLOBAL TOUCH HEARTS ============
    document.addEventListener('click', (e) => {
        // Heart
        const h = document.createElement('div');
        h.className = 'touch-heart';
        h.textContent = ['ü§ç','üíõ','üíó','‚ú®','ü¶Å','üê¨'][Math.floor(Math.random()*6)];
        h.style.left = e.clientX + 'px';
        h.style.top = e.clientY + 'px';
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 1200);
        // Ripple
        const r = document.createElement('div');
        r.className = 'tap-ripple';
        r.style.left = e.clientX + 'px';
        r.style.top = e.clientY + 'px';
        document.body.appendChild(r);
        setTimeout(() => r.remove(), 600);
    }, {passive:true});

    // ============ AMBIENT CANVAS ============
    const cv = document.getElementById('ambientCanvas');
    const cx = cv.getContext('2d');
    let ambPts = [], ambColor = {r:255,g:107,b:138};

    function resizeCV(){cv.width=innerWidth;cv.height=innerHeight}
    resizeCV(); addEventListener('resize', resizeCV);

    class AmbPt {
        constructor(){this.reset()}
        reset(){
            this.x=Math.random()*cv.width;this.y=Math.random()*cv.height;
            this.s=Math.random()*2.5+0.5;this.vy=-Math.random()*0.25-0.08;
            this.vx=(Math.random()-0.5)*0.25;this.o=Math.random()*0.4+0.05;
            this.phase=Math.random()*Math.PI*2;
        }
        update(){
            this.y+=this.vy;this.x+=this.vx+Math.sin(this.phase+=0.01)*0.2;
            if(this.y<-10){this.y=cv.height+10;this.x=Math.random()*cv.width}
        }
        draw(){
            cx.beginPath();cx.arc(this.x,this.y,this.s,0,Math.PI*2);
            cx.fillStyle=`rgba(${ambColor.r},${ambColor.g},${ambColor.b},${this.o})`;
            cx.fill();
        }
    }
    for(let i=0;i<45;i++) ambPts.push(new AmbPt());
    function animAmb(){cx.clearRect(0,0,cv.width,cv.height);ambPts.forEach(p=>{p.update();p.draw()});requestAnimationFrame(animAmb)}
    animAmb();

    function setAmb(r,g,b){ambColor={r,g,b}}

    // ============ AUDIO ============
    let audioCtx, audioOn=false;
    function toggleAudio(){
        const btn=document.getElementById('audioToggle');
        if(!audioOn){
            if(!audioCtx) audioCtx=new(window.AudioContext||window.webkitAudioContext)();
            audioOn=true;btn.textContent='üîä';btn.classList.add('on');playAmb();
        }else{audioOn=false;btn.textContent='üîá';btn.classList.remove('on')}
    }
    function playAmb(){
        if(!audioOn||!audioCtx)return;
        const o=audioCtx.createOscillator(),g=audioCtx.createGain();
        o.type='sine';
        const notes=[261.63,293.66,329.63,349.23,392,440,493.88];
        o.frequency.setValueAtTime(notes[Math.floor(Math.random()*notes.length)],audioCtx.currentTime);
        g.gain.setValueAtTime(0,audioCtx.currentTime);
        g.gain.linearRampToValueAtTime(0.025,audioCtx.currentTime+0.8);
        g.gain.linearRampToValueAtTime(0,audioCtx.currentTime+2.5);
        o.connect(g);g.connect(audioCtx.destination);o.start();o.stop(audioCtx.currentTime+2.5);
        setTimeout(()=>{if(audioOn)playAmb()},2000+Math.random()*1500);
    }

    // ============ SPLASH SCREEN ============
    setTimeout(()=>{
        const d=document.getElementById('splashDolphin');
        const l=document.getElementById('splashLion');
        d.classList.add('meet');l.classList.add('meet');
        setTimeout(()=>{
            document.getElementById('splashHeart').classList.add('show');
            splashParticles();
            setTimeout(()=>{
                document.getElementById('splash').classList.add('hide');
                setTimeout(()=>{
                    document.getElementById('splash').remove();
                    document.getElementById('scene0').classList.add('active');
                    initEnvelope();
                },800);
            },1200);
        },1200);
    },500);

    function splashParticles(){
        for(let i=0;i<20;i++){
            setTimeout(()=>{
                const p=document.createElement('div');p.className='floating-heart';
                p.textContent=['ü§ç','‚ú®','üíõ','üíó'][Math.floor(Math.random()*4)];
                p.style.left=40+Math.random()*20+'%';
                p.style.top=45+Math.random()*10+'%';
                p.style.fontSize=Math.random()*0.8+0.8+'rem';
                document.body.appendChild(p);setTimeout(()=>p.remove(),2500);
            },i*80);
        }
    }

    // ============ SCENE MANAGEMENT ============
    let currentScene=0; const totalScenes=9;

    function goToScene(n){
        const curr=document.getElementById('scene'+currentScene);
        const next=document.getElementById('scene'+n);
        showDuoTransition(currentScene, n);
        curr.classList.remove('active');curr.classList.add('cine-out');
        setTimeout(()=>{
            curr.classList.remove('cine-out');curr.style.opacity='0';curr.style.pointerEvents='none';
            next.classList.add('cine-in','active');
            currentScene=n;
            document.getElementById('progressBar').style.width=((n/(totalScenes-1))*100)+'%';
            initScene(n);
            setTimeout(()=>next.classList.remove('cine-in'),700);
        },600);
    }

    function initScene(n){
        switch(n){
            case 1:startStorm();break;
            case 2:setAmb(129,212,250);break;
            case 3:showLoveCards();break;
            case 4:initPuzzle();break;
            case 5:showFuture();break;
            case 6:showPromises();break;
            case 7:setAmb(255,107,138);break;
            case 8:startFinal();break;
        }
    }

    // ============ üê¨ü¶Å DUO TRANSITIONS ============
    let duoTogether = false;
    function showDuoTransition(from, to){
        if(to < 4) return; // Before puzzle they're apart
        const d=document.getElementById('duoDolphin');
        const l=document.getElementById('duoLion');
        const f=document.getElementById('duoFlash');

        if(to === 4 && !duoTogether){
            // Meeting at puzzle!
            d.style.transition='all 1.2s cubic-bezier(0.34,1.56,0.64,1)';
            l.style.transition='all 1.2s cubic-bezier(0.34,1.56,0.64,1)';
            d.classList.add('enter-dolphin');l.classList.add('enter-lion');
            setTimeout(()=>{
                f.classList.add('show');
                setTimeout(()=>f.classList.remove('show'),400);
                duoTogether=true;
                setTimeout(()=>{d.classList.remove('enter-dolphin');l.classList.remove('enter-lion');d.style.opacity='0';l.style.opacity='0'},1500);
            },1200);
        } else if(duoTogether && to >= 5){
            d.style.transition='all 0.8s ease';l.style.transition='all 0.8s ease';
            d.classList.add('together-dolphin');l.classList.add('together-lion');
            d.style.opacity='1';l.style.opacity='1';
            setTimeout(()=>{d.style.opacity='0';l.style.opacity='0';d.classList.remove('together-dolphin');l.classList.remove('together-lion')},1500);
        }
    }

    // ============ SCENE 0: ENVELOPE ============
    let heartTaps=0,heartTimer=null,secretShown=false;

    function initEnvelope(){
        setAmb(255,107,138);
        const env=document.getElementById('envelope');
        setTimeout(()=>{
            env.classList.add('opened');
            setTimeout(()=>{
                document.getElementById('introLabel').classList.add('visible');
                setTimeout(()=>document.getElementById('introName').classList.add('visible'),300);
                setTimeout(()=>document.getElementById('btnStart').classList.add('visible'),600);
            },500);
        },400);

        document.getElementById('envelopeHeart').addEventListener('click',(e)=>{
            e.stopPropagation();heartTaps++;
            clearTimeout(heartTimer);heartTimer=setTimeout(()=>{heartTaps=0},800);
            if(heartTaps>=3&&!secretShown){secretShown=true;document.getElementById('secretMsg').classList.add('show');heartTaps=0}
        });
    }

    // ============ SCENE 1: STORM ============
    function startStorm(){
        setAmb(129,157,219);
        const rc=document.getElementById('rainContainer');rc.innerHTML='';
        for(let i=0;i<90;i++){
            const d=document.createElement('div');d.className='raindrop';
            d.style.left=Math.random()*100+'%';d.style.height=Math.random()*22+12+'px';
            d.style.animationDuration=Math.random()*0.4+0.4+'s';
            d.style.animationDelay=Math.random()*2+'s';d.style.opacity=Math.random()*0.35+0.15;
            rc.appendChild(d);
        }
        // Lightning
        const lightInt=setInterval(()=>{
            if(currentScene!==1){clearInterval(lightInt);return}
            const lg=document.getElementById('lightning');
            lg.style.setProperty('--lx',Math.random()*80+10+'%');
            lg.style.setProperty('--ly',Math.random()*40+10+'%');
            lg.classList.add('flash');setTimeout(()=>lg.classList.remove('flash'),200);
        },3500+Math.random()*3000);

        // Rain touch
        document.getElementById('scene1').addEventListener('click',(e)=>{
            if(e.target.closest('.scene-btn'))return;
            const m=document.getElementById('rainTouchMsg');m.classList.add('show');
            setTimeout(()=>m.classList.remove('show'),1500);
        },{passive:true});

        const txt="Hubo una tormenta entre nosotros.\n\nY en vez de buscarte... me qued√© quieto.\n\nNo porque no me importaras, mi amor.\nNo porque no te amara.\n\nSino porque me puse bravo, y cuando me pongo as√≠... me cierro.\n\nY s√© que eso te doli√≥, princesa.";
        typewrite('stormText',txt,()=>document.getElementById('btnScene1').classList.add('visible'));
    }

    function typewrite(id,text,cb){
        const el=document.getElementById(id);el.innerHTML='<span class="cursor"></span>';
        let i=0,html='';
        function t(){
            if(i<text.length){
                html+=text[i]==='\n'?'<br>':text[i];
                el.innerHTML=html+'<span class="cursor"></span>';i++;
                const c=text[i-1];
                setTimeout(t,c==='.'?180:c===','?90:c==='\n'?280:c==='‚Ä¶'?220:c==='?'?140:30);
            }else{if(cb)setTimeout(cb,400)}
        }
        setTimeout(t,300);
    }

    // ============ SCENE 2: CLOUDS ============
    let cloudsR=0;
    function revealCloud(el,idx){
        if(el.classList.contains('revealed'))return;
        el.classList.add('revealed');cloudsR++;
        document.getElementById('cloudsCounter').textContent=cloudsR+' de 3 nubes despejadas';
        spawnHeart(el);
        if(cloudsR>=3){
            setTimeout(()=>{const b=document.getElementById('btnScene2');b.style.display='';b.classList.add('visible')},500);
        }
    }

    function spawnHeart(el){
        const emojis=['ü§ç','üíõ','üíó','‚ú®','ü¶Å','üê¨'];
        for(let i=0;i<3;i++){
            setTimeout(()=>{
                const h=document.createElement('div');h.className='floating-heart';
                h.textContent=emojis[Math.floor(Math.random()*emojis.length)];
                h.style.fontSize=Math.random()*0.6+1+'rem';
                const r=el.getBoundingClientRect();
                h.style.left=r.left+Math.random()*r.width+'px';h.style.top=r.top+'px';
                document.body.appendChild(h);setTimeout(()=>h.remove(),2500);
            },i*150);
        }
    }

    // ============ SCENE 3: LOVE + PETALS ============
    function showLoveCards(){
        setAmb(255,107,138);
        const cards=document.querySelectorAll('.love-card');
        cards.forEach((c,i)=>setTimeout(()=>c.classList.add('show'),350*i));
        startPetals();
    }

    function startPetals(){
        const colors=['rgba(255,107,138,0.4)','rgba(255,212,222,0.35)','rgba(255,179,55,0.3)','rgba(179,157,219,0.3)'];
        const int=setInterval(()=>{
            if(currentScene!==3){clearInterval(int);return}
            const p=document.createElement('div');p.className='petal';
            p.style.left=Math.random()*100+'%';p.style.top='-15px';
            p.style.background=colors[Math.floor(Math.random()*colors.length)];
            p.style.width=Math.random()*8+8+'px';p.style.height=Math.random()*8+8+'px';
            p.style.animationDuration=Math.random()*3+4+'s';
            document.body.appendChild(p);setTimeout(()=>p.remove(),7000);
        },400);
    }

    // ============ SCENE 4: PUZZLE ============
    const puzzleEmojis=['ü¶Å','üê¨','ü§ç','üåô','üî•','üè†','‚ú®','üí´','‚ù§Ô∏è'];
    let puzzleFound=0,lionF=false,dolphinF=false;

    function initPuzzle(){
        setAmb(255,179,55);
        const grid=document.getElementById('puzzleGrid');grid.innerHTML='';
        const shuffled=[...puzzleEmojis].sort(()=>Math.random()-0.5);
        shuffled.forEach((em)=>{
            const p=document.createElement('div');p.className='puzzle-piece';
            const s=document.createElement('span');s.className='silhouette';s.textContent=em;
            p.appendChild(s);p.onclick=()=>clickPiece(p,em);
            grid.appendChild(p);
        });
    }

    function clickPiece(p,em){
        if(p.classList.contains('found'))return;
        p.classList.add('found');puzzleFound++;spawnHeart(p);

        if(em==='ü¶Å'){lionF=true;p.classList.add('lion-found')}
        else if(em==='üê¨'){dolphinF=true;p.classList.add('dolphin-found')}

        if(lionF&&dolphinF){
            document.querySelectorAll('.puzzle-piece.found').forEach(pp=>{
                const t=pp.querySelector('.silhouette').textContent;
                if(t==='ü¶Å'||t==='üê¨'){pp.style.boxShadow='0 0 30px rgba(255,255,255,0.4),0 0 60px rgba(255,107,138,0.3)'}
            });
        }

        if(puzzleFound>=puzzleEmojis.length){
            setTimeout(()=>{
                const duo=document.getElementById('puzzleDuo');duo.classList.add('show');
                launchConfetti(35);
                setTimeout(()=>{
                    document.getElementById('puzzleMessage').classList.add('visible');
                    setTimeout(()=>{const b=document.getElementById('btnScene4');b.style.display='';b.classList.add('visible')},700);
                },600);
            },400);
        }
    }

    function launchConfetti(count){
        const colors=['#FF6B8A','#FFB347','#B39DDB','#81D4FA','#7DDDB3','#FFD4DE','#FFC96F'];
        for(let i=0;i<count;i++){
            setTimeout(()=>{
                const p=document.createElement('div');p.className='confetti-piece';
                p.style.left=Math.random()*100+'%';
                p.style.background=colors[Math.floor(Math.random()*colors.length)];
                const size=Math.random()*8+5;p.style.width=size+'px';p.style.height=size+'px';
                p.style.borderRadius=Math.random()>0.5?'50%':'3px';
                p.style.animationDuration=Math.random()*2+2.5+'s';
                document.body.appendChild(p);setTimeout(()=>p.remove(),5000);
            },i*50);
        }
    }

    // ============ SCENE 5: FUTURE ============
    let futureT=0;
    function showFuture(){
        setAmb(255,179,55);
        const cards=document.querySelectorAll('.future-card');
        cards.forEach((c,i)=>setTimeout(()=>c.classList.add('show'),250*i));
    }
    function tapFuture(el){
        if(el.classList.contains('tapped'))return;
        el.classList.add('tapped');futureT++;spawnHeart(el);
        if(futureT>=5){setTimeout(()=>{const b=document.getElementById('btnScene5');b.style.display='';b.classList.add('visible')},400)}
    }

    // ============ SCENE 6: PROMISES ============
    function showPromises(){
        setAmb(125,221,179);
        const items=document.querySelectorAll('.promise-item');
        items.forEach((item,i)=>{
            setTimeout(()=>{item.classList.add('show');setTimeout(()=>item.classList.add('checked'),500)},450*i);
        });
        setTimeout(()=>{
            document.getElementById('promiseNote').classList.add('visible');
            setTimeout(()=>{const b=document.getElementById('btnScene6');b.style.display='';b.classList.add('visible')},600);
        },450*items.length+400);
    }

    // ============ SCENE 7: WRITE ============
    function saveNote(){
        const txt=document.getElementById('writeArea').value;
        if(txt.trim()){localStorage.setItem('sofi_note',txt);showToast('Guardado en mi coraz√≥n üíõ')}
        else{showToast('Escribe algo, princesa ü§ç')}
    }

    // ============ SCENE 8: FINAL ============
    function startFinal(){
        setAmb(255,107,138);createStars();launchConfetti(70);startHeartParticles();
        setTimeout(()=>document.getElementById('spotifyEmbed').classList.add('visible'),800);
        setTimeout(()=>document.getElementById('btnCopyWha').classList.add('visible'),2500);
        setTimeout(()=>document.getElementById('btnReplay').classList.add('visible'),3500);

        const msg="No soy perfecto, mi amor. Y probablemente nunca lo sea. Pero te amo con todo lo que soy, incluso con las partes que me cuestan.\n\nS√© que te quedas porque me amas much√≠simo, y yo quiero que sepas que estoy eligiendo quedarme tambi√©n. Trabajar en lo que me cuesta. Amarte como te mereces.\n\nNo con promesas grandes que despu√©s pesen... sino con intenciones reales, d√≠a a d√≠a.\n\nWon't you stay with me? Cause you're all I need. üéµ\n\nTe amo con todo, mi leoncita. Juntos. üê¨ü¶Åü§ç";
        typewrite('finalMsg',msg,null);
    }

    function createStars(){
        const sc=document.getElementById('scene8');
        for(let i=0;i<50;i++){
            const s=document.createElement('div');s.className='star';
            s.style.left=Math.random()*100+'%';s.style.top=Math.random()*100+'%';
            const size=Math.random()*2.5+0.5;s.style.width=size+'px';s.style.height=size+'px';
            s.style.animationDelay=Math.random()*3+'s';s.style.animationDuration=Math.random()*2+2+'s';
            sc.appendChild(s);
        }
    }

    function startHeartParticles(){
        const emojis=['‚ù§Ô∏è','üß°','üíõ','ü§ç','üíó','ü¶Å','üê¨','‚ú®'];
        function spawn(){
            if(currentScene!==8)return;
            const h=document.createElement('div');h.className='heart-particle';
            h.textContent=emojis[Math.floor(Math.random()*emojis.length)];
            h.style.left=Math.random()*100+'%';h.style.bottom='-20px';
            h.style.fontSize=Math.random()*0.8+0.6+'rem';
            h.style.animationDuration=Math.random()*3+3.5+'s';
            document.body.appendChild(h);setTimeout(()=>h.remove(),7000);
            setTimeout(spawn,250+Math.random()*400);
        }
        spawn();
    }

    // ============ COPY WHA MESSAGE ============
    function copyWhaMsg(){
        navigator.clipboard.writeText(WHA_MSG).then(()=>{
            showToast('Mensaje copiado üíõ p√©galo en nuestro chat');
        }).catch(()=>{
            // Fallback
            const ta=document.createElement('textarea');ta.value=WHA_MSG;
            document.body.appendChild(ta);ta.select();document.execCommand('copy');
            document.body.removeChild(ta);
            showToast('Mensaje copiado üíõ p√©galo en nuestro chat');
        });
    }

    // ============ TOAST ============
    function showToast(msg){
        const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');
        setTimeout(()=>t.classList.remove('show'),3000);
    }

    // ============ REPLAY ============
    function replayAll(){
        location.reload();
    }

    </script>
</body>
</html>

